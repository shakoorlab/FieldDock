{"ast":null,"code":"'use strict';\n\nconst {\n  AbortError,\n  codes\n} = require('../../ours/errors');\nconst {\n  isNodeStream,\n  isWebStream,\n  kControllerErrorFunction\n} = require('./utils');\nconst eos = require('./end-of-stream');\nconst {\n  ERR_INVALID_ARG_TYPE\n} = codes;\n\n// This method is inlined here for readable-stream\n// It also does not allow for signal to not exist on the stream\n// https://github.com/nodejs/node/pull/36061#discussion_r533718029\nconst validateAbortSignal = (signal, name) => {\n  if (typeof signal !== 'object' || !('aborted' in signal)) {\n    throw new ERR_INVALID_ARG_TYPE(name, 'AbortSignal', signal);\n  }\n};\nmodule.exports.addAbortSignal = function addAbortSignal(signal, stream) {\n  validateAbortSignal(signal, 'signal');\n  if (!isNodeStream(stream) && !isWebStream(stream)) {\n    throw new ERR_INVALID_ARG_TYPE('stream', ['ReadableStream', 'WritableStream', 'Stream'], stream);\n  }\n  return module.exports.addAbortSignalNoValidate(signal, stream);\n};\nmodule.exports.addAbortSignalNoValidate = function (signal, stream) {\n  if (typeof signal !== 'object' || !('aborted' in signal)) {\n    return stream;\n  }\n  const onAbort = isNodeStream(stream) ? () => {\n    stream.destroy(new AbortError(undefined, {\n      cause: signal.reason\n    }));\n  } : () => {\n    stream[kControllerErrorFunction](new AbortError(undefined, {\n      cause: signal.reason\n    }));\n  };\n  if (signal.aborted) {\n    onAbort();\n  } else {\n    signal.addEventListener('abort', onAbort);\n    eos(stream, () => signal.removeEventListener('abort', onAbort));\n  }\n  return stream;\n};","map":{"version":3,"names":["AbortError","codes","require","isNodeStream","isWebStream","kControllerErrorFunction","eos","ERR_INVALID_ARG_TYPE","validateAbortSignal","signal","name","module","exports","addAbortSignal","stream","addAbortSignalNoValidate","onAbort","destroy","undefined","cause","reason","aborted","addEventListener","removeEventListener"],"sources":["/Users/jstanton/Coding/FieldDock/FieldDockMain/node_modules/mqtt/node_modules/readable-stream/lib/internal/streams/add-abort-signal.js"],"sourcesContent":["'use strict'\n\nconst { AbortError, codes } = require('../../ours/errors')\nconst { isNodeStream, isWebStream, kControllerErrorFunction } = require('./utils')\nconst eos = require('./end-of-stream')\nconst { ERR_INVALID_ARG_TYPE } = codes\n\n// This method is inlined here for readable-stream\n// It also does not allow for signal to not exist on the stream\n// https://github.com/nodejs/node/pull/36061#discussion_r533718029\nconst validateAbortSignal = (signal, name) => {\n  if (typeof signal !== 'object' || !('aborted' in signal)) {\n    throw new ERR_INVALID_ARG_TYPE(name, 'AbortSignal', signal)\n  }\n}\nmodule.exports.addAbortSignal = function addAbortSignal(signal, stream) {\n  validateAbortSignal(signal, 'signal')\n  if (!isNodeStream(stream) && !isWebStream(stream)) {\n    throw new ERR_INVALID_ARG_TYPE('stream', ['ReadableStream', 'WritableStream', 'Stream'], stream)\n  }\n  return module.exports.addAbortSignalNoValidate(signal, stream)\n}\nmodule.exports.addAbortSignalNoValidate = function (signal, stream) {\n  if (typeof signal !== 'object' || !('aborted' in signal)) {\n    return stream\n  }\n  const onAbort = isNodeStream(stream)\n    ? () => {\n        stream.destroy(\n          new AbortError(undefined, {\n            cause: signal.reason\n          })\n        )\n      }\n    : () => {\n        stream[kControllerErrorFunction](\n          new AbortError(undefined, {\n            cause: signal.reason\n          })\n        )\n      }\n  if (signal.aborted) {\n    onAbort()\n  } else {\n    signal.addEventListener('abort', onAbort)\n    eos(stream, () => signal.removeEventListener('abort', onAbort))\n  }\n  return stream\n}\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAM;EAAEA,UAAU;EAAEC;AAAM,CAAC,GAAGC,OAAO,CAAC,mBAAmB,CAAC;AAC1D,MAAM;EAAEC,YAAY;EAAEC,WAAW;EAAEC;AAAyB,CAAC,GAAGH,OAAO,CAAC,SAAS,CAAC;AAClF,MAAMI,GAAG,GAAGJ,OAAO,CAAC,iBAAiB,CAAC;AACtC,MAAM;EAAEK;AAAqB,CAAC,GAAGN,KAAK;;AAEtC;AACA;AACA;AACA,MAAMO,mBAAmB,GAAGA,CAACC,MAAM,EAAEC,IAAI,KAAK;EAC5C,IAAI,OAAOD,MAAM,KAAK,QAAQ,IAAI,EAAE,SAAS,IAAIA,MAAM,CAAC,EAAE;IACxD,MAAM,IAAIF,oBAAoB,CAACG,IAAI,EAAE,aAAa,EAAED,MAAM,CAAC;EAC7D;AACF,CAAC;AACDE,MAAM,CAACC,OAAO,CAACC,cAAc,GAAG,SAASA,cAAcA,CAACJ,MAAM,EAAEK,MAAM,EAAE;EACtEN,mBAAmB,CAACC,MAAM,EAAE,QAAQ,CAAC;EACrC,IAAI,CAACN,YAAY,CAACW,MAAM,CAAC,IAAI,CAACV,WAAW,CAACU,MAAM,CAAC,EAAE;IACjD,MAAM,IAAIP,oBAAoB,CAAC,QAAQ,EAAE,CAAC,gBAAgB,EAAE,gBAAgB,EAAE,QAAQ,CAAC,EAAEO,MAAM,CAAC;EAClG;EACA,OAAOH,MAAM,CAACC,OAAO,CAACG,wBAAwB,CAACN,MAAM,EAAEK,MAAM,CAAC;AAChE,CAAC;AACDH,MAAM,CAACC,OAAO,CAACG,wBAAwB,GAAG,UAAUN,MAAM,EAAEK,MAAM,EAAE;EAClE,IAAI,OAAOL,MAAM,KAAK,QAAQ,IAAI,EAAE,SAAS,IAAIA,MAAM,CAAC,EAAE;IACxD,OAAOK,MAAM;EACf;EACA,MAAME,OAAO,GAAGb,YAAY,CAACW,MAAM,CAAC,GAChC,MAAM;IACJA,MAAM,CAACG,OAAO,CACZ,IAAIjB,UAAU,CAACkB,SAAS,EAAE;MACxBC,KAAK,EAAEV,MAAM,CAACW;IAChB,CAAC,CACH,CAAC;EACH,CAAC,GACD,MAAM;IACJN,MAAM,CAACT,wBAAwB,CAAC,CAC9B,IAAIL,UAAU,CAACkB,SAAS,EAAE;MACxBC,KAAK,EAAEV,MAAM,CAACW;IAChB,CAAC,CACH,CAAC;EACH,CAAC;EACL,IAAIX,MAAM,CAACY,OAAO,EAAE;IAClBL,OAAO,CAAC,CAAC;EACX,CAAC,MAAM;IACLP,MAAM,CAACa,gBAAgB,CAAC,OAAO,EAAEN,OAAO,CAAC;IACzCV,GAAG,CAACQ,MAAM,EAAE,MAAML,MAAM,CAACc,mBAAmB,CAAC,OAAO,EAAEP,OAAO,CAAC,CAAC;EACjE;EACA,OAAOF,MAAM;AACf,CAAC"},"metadata":{},"sourceType":"script"}